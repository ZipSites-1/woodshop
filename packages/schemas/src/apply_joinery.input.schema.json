{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://woodshop.dev/schemas/apply_joinery.input.json",
  "title": "ApplyJoineryInput",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "project_id": {
      "allOf": [
        { "$ref": "./common.schema.json#/$defs/projectId" }
      ]
    },
    "seed": {
      "allOf": [
        { "$ref": "./common.schema.json#/$defs/seedInput" }
      ]
    },
    "idempotency_key": {
      "$ref": "./common.schema.json#/$defs/idempotencyKey"
    },
    "operations": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "id": { "type": "string" },
          "type": {
            "type": "string",
            "enum": ["dado", "rabbet", "mortise", "tenon", "lap", "dowel"]
          },
          "primary_part_id": { "type": "string" },
          "secondary_part_id": { "type": ["string", "null"] },
          "face": {
            "type": "string",
            "enum": ["interior", "exterior", "edge"]
          },
          "offset_mm": { "type": "number" },
          "length_mm": { "type": "number", "minimum": 0 },
          "width_mm": { "type": "number", "minimum": 0 },
          "depth_mm": { "type": "number", "minimum": 0 },
          "angle_deg": { "type": ["number", "null"] },
          "fasteners": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["screw", "dowel", "nail", "biscuit"]
                },
                "spacing_mm": { "type": "number", "minimum": 0 },
                "diameter_mm": { "type": "number", "minimum": 0 }
              },
              "required": ["type", "spacing_mm", "diameter_mm"]
            }
          },
          "metadata": {
            "type": "object",
            "additionalProperties": true
          }
        },
        "required": [
          "type",
          "primary_part_id",
          "face",
          "offset_mm",
          "length_mm",
          "width_mm",
          "depth_mm"
        ]
      }
    },
    "notes": { "type": "string" }
  },
  "required": ["project_id", "operations"]
}
